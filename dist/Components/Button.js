import React from 'react';
import { TouchableOpacity, TouchableHighlight, TouchableWithoutFeedback, Modal, SafeAreaView, } from 'react-native';
import { WebView } from 'react-native-webview';
import Header from './Header';
import twitter from '../client';
class TWLoginButton extends React.Component {
    constructor(props) {
        super(props);
        this.onNavigationStateChange = async (webViewState) => {
            const match = webViewState.url.match(/\?oauth_token=.+&oauth_verifier=(.+)/);
            if (match && match.length > 0) {
                this.setState({
                    isVisible: false,
                });
                try {
                    const response = await twitter.getAccessToken(match[1]);
                    if (response.errors) {
                        throw new Error(JSON.stringify(response.errors));
                    }
                    this.token = response;
                }
                catch (err) {
                    console.warn(`[getAccessToken failed] ${err}`);
                    this.props.onError(err);
                }
                await this.props.onGetAccessToken(this.token);
                try {
                    const response = await twitter.get('account/verify_credentials.json', { include_entities: false, skip_status: true, include_email: true });
                    if (response.errors) {
                        throw new Error(JSON.stringify(response.errors));
                    }
                    this.user = response;
                }
                catch (err) {
                    console.warn(`[get("account/verify_credentials.json") failed] ${err}`);
                    this.props.onError(err);
                    return false;
                }
                await this.props.onSuccess(this.user);
                return true;
            }
            return false;
        };
        this.onButtonPress = async (e) => {
            await this.props.onPress(e);
            this.setState({
                isVisible: true,
                authURL: await twitter.getLoginUrl(this.props.callbackUrl),
            });
        };
        this.onClose = (e) => {
            this.setState({
                isVisible: false,
            }, () => this.props.onClose(e));
        };
        this.renderHeader = (props) => {
            if (this.props.renderHeader) {
                return React.cloneElement(this.props.renderHeader(props), props);
            }
            return <Header {...props}/>;
        };
        this.state = {
            isVisible: false,
            authURL: '',
        };
        this.token = '';
        this.user = null;
    }
    render() {
        let Component;
        switch (this.props.type) {
            case 'TouchableOpacity':
                Component = TouchableOpacity;
                break;
            case 'TouchableHighlight':
                Component = TouchableHighlight;
                break;
            case 'TouchableWithoutFeedback':
                Component = TouchableWithoutFeedback;
                break;
            default:
                console.warn('TWLoginButton type must be TouchableOpacity or TouchableHighlight or TouchableWithoutFeedback');
                return null;
        }
        return (<Component {...this.props} onPress={this.onButtonPress}>
        {this.props.children}
        <Modal visible={this.state.isVisible} animationType="slide" onRequestClose={() => { }}>
          <SafeAreaView style={{ flex: 1, backgroundColor: this.props.headerColor }}>
            {this.renderHeader({ headerColor: this.props.headerColor, onClose: this.onClose })}
            <WebView source={{ uri: this.state.authURL }} onNavigationStateChange={this.onNavigationStateChange}/>
          </SafeAreaView>
        </Modal>
      </Component>);
    }
}
TWLoginButton.defaultProps = {
    type: 'TouchableOpacity',
    headerColor: '#f7f7f7',
    callbackUrl: null,
    onPress: () => { },
    onGetAccessToken: () => { },
    onClose: () => { },
    onError: () => { },
    renderHeader: (props = {}) => <Header {...props}/>,
};
export default TWLoginButton;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQnV0dG9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL0NvbXBvbmVudHMvQnV0dG9uLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxFQUNMLGdCQUFnQixFQUNoQixrQkFBa0IsRUFDbEIsd0JBQXdCLEVBQ3hCLEtBQUssRUFDTCxZQUFZLEdBQ2IsTUFBTSxjQUFjLENBQUM7QUFHdEIsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRy9DLE9BQU8sTUFBTSxNQUFNLFVBQVUsQ0FBQztBQUc5QixPQUFPLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFtQmhDLE1BQU0sYUFBYyxTQUFRLEtBQUssQ0FBQyxTQUF1QjtJQVl2RCxZQUFZLEtBQVU7UUFDcEIsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBV2YsNEJBQXVCLEdBQUcsS0FBSyxFQUFFLFlBQWlCLEVBQUUsRUFBRTtZQUNwRCxNQUFNLEtBQUssR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1lBRTdFLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUM3QixJQUFJLENBQUMsUUFBUSxDQUFDO29CQUNaLFNBQVMsRUFBRSxLQUFLO2lCQUNqQixDQUFDLENBQUM7Z0JBR0gsSUFBSTtvQkFDRixNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBRXhELElBQUksUUFBUSxDQUFDLE1BQU0sRUFBRTt3QkFDbkIsTUFBTSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO3FCQUNsRDtvQkFFRCxJQUFJLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQztpQkFDdkI7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LFdBQVcsRUFBRSxTQUFTO0lBQ3RCLFdBQVcsRUFBRSxJQUFJO0lBQ2pCLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ2xCLGdCQUFnQixFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDM0IsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDbEIsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDbEIsWUFBWSxFQUFFLENBQUMsS0FBSyxHQUFHLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsRUFBRztDQUNwRCxDQUFBO0FBOEhILGVBQWUsYUFBYSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIFRvdWNoYWJsZU9wYWNpdHksXG4gIFRvdWNoYWJsZUhpZ2hsaWdodCxcbiAgVG91Y2hhYmxlV2l0aG91dEZlZWRiYWNrLFxuICBNb2RhbCxcbiAgU2FmZUFyZWFWaWV3LFxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuXG4vKiBucG0gKi9cbmltcG9ydCB7IFdlYlZpZXcgfSBmcm9tICdyZWFjdC1uYXRpdmUtd2Vidmlldyc7XG5cbi8qIGNvbXBvbmVudHMgKi9cbmltcG9ydCBIZWFkZXIgZnJvbSAnLi9IZWFkZXInO1xuXG4vKiBjbGllbnQgKi9cbmltcG9ydCB0d2l0dGVyIGZyb20gJy4uL2NsaWVudCc7XG5cbmludGVyZmFjZSBQcm9wcyB7XG4gIHR5cGU6IHN0cmluZyxcbiAgaGVhZGVyQ29sb3I6IHN0cmluZyxcbiAgY2FsbGJhY2tVcmw6IHN0cmluZyxcbiAgb25QcmVzcyhlOiBhbnkpOiB2b2lkLFxuICBvbkdldEFjY2Vzc1Rva2VuKHRva2VuOiBzdHJpbmcpOiB2b2lkLFxuICBvbkNsb3NlKGU6IGFueSk6IHZvaWQsXG4gIG9uU3VjY2Vzcyh1c2VyOiBhbnkpOiB2b2lkLFxuICBvbkVycm9yKGVycjogYW55KTogdm9pZCxcbiAgcmVuZGVySGVhZGVyKHByb3BzOiBhbnkpOiBSZWFjdC5SZWFjdEVsZW1lbnQ8e30+LFxufVxuXG5pbnRlcmZhY2UgU3RhdGUge1xuICBpc1Zpc2libGU6IGJvb2xlYW4sXG4gIGF1dGhVUkw6IHN0cmluZyxcbn1cblxuY2xhc3MgVFdMb2dpbkJ1dHRvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICB0eXBlOiAnVG91Y2hhYmxlT3BhY2l0eScsXG4gICAgaGVhZGVyQ29sb3I6ICcjZjdmN2Y3JyxcbiAgICBjYWxsYmFja1VybDogbnVsbCxcbiAgICBvblByZXNzOiAoKSA9PiB7IH0sXG4gICAgb25HZXRBY2Nlc3NUb2tlbjogKCkgPT4geyB9LFxuICAgIG9uQ2xvc2U6ICgpID0+IHsgfSxcbiAgICBvbkVycm9yOiAoKSA9PiB7IH0sXG4gICAgcmVuZGVySGVhZGVyOiAocHJvcHMgPSB7fSkgPT4gPEhlYWRlciB7Li4ucHJvcHN9IC8+LFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IGFueSkge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBpc1Zpc2libGU6IGZhbHNlLFxuICAgICAgYXV0aFVSTDogJycsXG4gICAgfTtcblxuICAgIHRoaXMudG9rZW4gPSAnJztcbiAgICB0aGlzLnVzZXIgPSBudWxsO1xuICB9XG5cbiAgb25OYXZpZ2F0aW9uU3RhdGVDaGFuZ2UgPSBhc3luYyAod2ViVmlld1N0YXRlOiBhbnkpID0+IHtcbiAgICBjb25zdCBtYXRjaCA9IHdlYlZpZXdTdGF0ZS51cmwubWF0Y2goL1xcP29hdXRoX3Rva2VuPS4rJm9hdXRoX3ZlcmlmaWVyPSguKykvKTtcblxuICAgIGlmIChtYXRjaCAmJiBtYXRjaC5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgaXNWaXNpYmxlOiBmYWxzZSxcbiAgICAgIH0pO1xuXG4gICAgICAvKiBnZXQgYWNjZXNzIHRva2VuICovXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHR3aXR0ZXIuZ2V0QWNjZXNzVG9rZW4obWF0Y2hbMV0pO1xuXG4gICAgICAgIGlmIChyZXNwb25zZS5lcnJvcnMpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZXJyb3JzKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRva2VuID0gcmVzcG9uc2U7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBbZ2V0QWNjZXNzVG9rZW4gZmFpbGVkXSAke2Vycn1gKTtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkVycm9yKGVycik7XG4gICAgICB9XG5cbiAgICAgIGF3YWl0IHRoaXMucHJvcHMub25HZXRBY2Nlc3NUb2tlbih0aGlzLnRva2VuKTtcblxuICAgICAgLyogZ2V0IGFjY291bnQgKi9cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdHdpdHRlci5nZXQoJ2FjY291bnQvdmVyaWZ5X2NyZWRlbnRpYWxzLmpzb24nLCB7IGluY2x1ZGVfZW50aXRpZXM6IGZhbHNlLCBza2lwX3N0YXR1czogdHJ1ZSwgaW5jbHVkZV9lbWFpbDogdHJ1ZSB9KTtcblxuICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JzKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLmVycm9ycykpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy51c2VyID0gcmVzcG9uc2U7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBbZ2V0KFwiYWNjb3VudC92ZXJpZnlfY3JlZGVudGlhbHMuanNvblwiKSBmYWlsZWRdICR7ZXJyfWApO1xuICAgICAgICB0aGlzLnByb3BzLm9uRXJyb3IoZXJyKTtcblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGF3YWl0IHRoaXMucHJvcHMub25TdWNjZXNzKHRoaXMudXNlcik7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIG9uQnV0dG9uUHJlc3MgPSBhc3luYyAoZTogYW55KTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgYXdhaXQgdGhpcy5wcm9wcy5vblByZXNzKGUpO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpc1Zpc2libGU6IHRydWUsXG4gICAgICBhdXRoVVJMOiBhd2FpdCB0d2l0dGVyLmdldExvZ2luVXJsKHRoaXMucHJvcHMuY2FsbGJhY2tVcmwpLFxuICAgIH0pO1xuICB9XG5cbiAgb25DbG9zZSA9IChlOiBhbnkpID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGlzVmlzaWJsZTogZmFsc2UsXG4gICAgfSwgKCkgPT4gdGhpcy5wcm9wcy5vbkNsb3NlKGUpKTtcbiAgfVxuXG4gIHRva2VuITogYW55XG5cbiAgdXNlciE6IGFueVxuXG4gIHJlbmRlckhlYWRlciA9IChwcm9wczogYW55KSA9PiB7XG4gICAgaWYgKHRoaXMucHJvcHMucmVuZGVySGVhZGVyKSB7XG4gICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KHRoaXMucHJvcHMucmVuZGVySGVhZGVyKHByb3BzKSwgcHJvcHMpO1xuICAgIH1cblxuICAgIHJldHVybiA8SGVhZGVyIHsuLi5wcm9wc30gLz47XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgbGV0IENvbXBvbmVudDtcblxuICAgIHN3aXRjaCAodGhpcy5wcm9wcy50eXBlKSB7XG4gICAgICBjYXNlICdUb3VjaGFibGVPcGFjaXR5JzpcbiAgICAgICAgQ29tcG9uZW50ID0gVG91Y2hhYmxlT3BhY2l0eTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdUb3VjaGFibGVIaWdobGlnaHQnOlxuICAgICAgICBDb21wb25lbnQgPSBUb3VjaGFibGVIaWdobGlnaHQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnVG91Y2hhYmxlV2l0aG91dEZlZWRiYWNrJzpcbiAgICAgICAgQ29tcG9uZW50ID0gVG91Y2hhYmxlV2l0aG91dEZlZWRiYWNrO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGNvbnNvbGUud2FybignVFdMb2dpbkJ1dHRvbiB0eXBlIG11c3QgYmUgVG91Y2hhYmxlT3BhY2l0eSBvciBUb3VjaGFibGVIaWdobGlnaHQgb3IgVG91Y2hhYmxlV2l0aG91dEZlZWRiYWNrJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8Q29tcG9uZW50IHsuLi50aGlzLnByb3BzfSBvblByZXNzPXt0aGlzLm9uQnV0dG9uUHJlc3N9PlxuICAgICAgICB7dGhpcy5wcm9wcy5jaGlsZHJlbn1cbiAgICAgICAgPE1vZGFsXG4gICAgICAgICAgdmlzaWJsZT17dGhpcy5zdGF0ZS5pc1Zpc2libGV9XG4gICAgICAgICAgYW5pbWF0aW9uVHlwZT1cInNsaWRlXCJcbiAgICAgICAgICBvblJlcXVlc3RDbG9zZT17KCkgPT4geyB9XG4gICAgICAgICAgfVxuICAgICAgICA+XG4gICAgICAgICAgPFNhZmVBcmVhVmlldyBzdHlsZT17eyBmbGV4OiAxLCBiYWNrZ3JvdW5kQ29sb3I6IHRoaXMucHJvcHMuaGVhZGVyQ29sb3IgfX0+XG4gICAgICAgICAgICB7dGhpcy5yZW5kZXJIZWFkZXIoeyBoZWFkZXJDb2xvcjogdGhpcy5wcm9wcy5oZWFkZXJDb2xvciwgb25DbG9zZTogdGhpcy5vbkNsb3NlIH0pfVxuICAgICAgICAgICAgPFdlYlZpZXcgc291cmNlPXt7IHVyaTogdGhpcy5zdGF0ZS5hdXRoVVJMIH19IG9uTmF2aWdhdGlvblN0YXRlQ2hhbmdlPXt0aGlzLm9uTmF2aWdhdGlvblN0YXRlQ2hhbmdlfSAvPlxuICAgICAgICAgIDwvU2FmZUFyZWFWaWV3PlxuICAgICAgICA8L01vZGFsPlxuICAgICAgPC9Db21wb25lbnQ+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBUV0xvZ2luQnV0dG9uO1xuIl19